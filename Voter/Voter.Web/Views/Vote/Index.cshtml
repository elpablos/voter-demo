@model Voter.Web.Controllers.Vote.Votes.List.ListVoteModel
@{
    ViewBag.Title = "Přehled";
}

<div class="app-title">
    <div>
        <h1><i class="fa fa-money"></i> Detail záznamu</h1>
        <p>Všechny podrobnosti o daném záznamu</p>
    </div>
    <ul class="app-breadcrumb breadcrumb">
        <li class="breadcrumb-item"><a href="@Url.Action("Index", "Campaign")"><i class="fa fa-home fa-lg"></i></a></li>
        <li class="breadcrumb-item">@Html.ActionLink("Přehled", "Index")</li>
        @*<li class="breadcrumb-item"><a href="@Url.Action()">Detail záznamu</a></li>*@
    </ul>
</div>

@Html.Action("DetailHeaderPartial", "Campaign", new { ID = Request.QueryString.Get("ID_Campaign") })

<div class="row">
    <div class="col-md-12">

        <ul class="nav nav-tabs">
            @if (Html.HasAction("VT_Question_DETAIL"))
            {
                <li class="nav-item">
                    @Html.ActionLink("Detail", "Detail", new { id = Url.RequestContext.RouteData.Values["id"] }, htmlAttributes: new { @class = "nav-link active" })
                </li>
            }
            @if (Html.HasAction("CR_EntityLog_ALL_Question_VT"))
            {
                <li class="nav-item">
                    @Html.ActionLink("Historie", "History", new { id = Url.RequestContext.RouteData.Values["id"] }, htmlAttributes: new { @class = "nav-link" })
                </li>
            }
        </ul>

        <div class="tile">
            <div class="tile-title line-head">
                <h3>Graf</h3>
            </div>
            <div class="tile-body">
                <div class="row">
                    <canvas id="myChart" class="max-width: 500px"></canvas>
                </div>
            </div>

            <div class="tile-footer">
            </div>
        </div>

        @*<div class="tile">
            <div class="tile-title line-head">
                <h3>@ViewBag.Title</h3>
            </div>
            <div class="tile-body">


                @Html.Partial("_IndexItems", Model.Items)
            </div>

            <div class="tile-footer">
            </div>
        </div>*@
    </div>
</div>

<div class="container">
    <input type="text" id="message" />
    <input type="button" id="sendmessage" value="Send" />
    <input type="hidden" id="displayname" />
    <ul id="discussion"></ul>
</div>

@section scripts {

    <!--Script references. -->
    <!--Reference the jQuery library. -->
    @*<script src="Scripts/jquery-3.2.1.min.js"></script>*@
    <!--Reference the SignalR library. -->
    <script src="/Scripts/jquery.signalR-2.4.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
        $(function () {
            // Declare a proxy to reference the hub.
            var chat = $.connection.voterHub;
            // Create a function that the hub can call to broadcast messages.
            chat.client.broadcastMessage = function (name, message) {
                // Html encode display name and message.
                //var encodedName = $('<div />').text(name).html();
                //var encodedMsg = $('<div />').text(message).html();
                //// Add the message to the page.
                //$('#discussion').append('<li><strong>' + encodedName
                //    + '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');

                if (chart) {

                    var index = -1;
                    for (i = 0; i < chart.data.labels.length; i++) {
                        if (chart.data.labels[i] == message) {
                            index = i;
                            break;
                        }
                    }

                    if (index > -1) {
                        chart.data.datasets[0].data[index]++;
                        chart.update();
                    }


                }
            };
            //// Get the user name and store it to prepend to messages.
            //$('#displayname').val(prompt('Enter your name:', ''));
            //// Set initial focus to message input box.
            //$('#message').focus();
            //// Start the connection.
            $.connection.hub.start().done(function () {
                //$('#sendmessage').click(function () {
                //    // Call the Send method on the hub.
                //    chat.server.send($('#displayname').val(), $('#message').val());
                //    // Clear text box and reset focus for next comment.
                //    $('#message').val('').focus();
                //});
            });
        });
    </script>

    <script>
        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {
            // The type of chart we want to create
            type: 'pie',

            // The data for our dataset
            data: {
                labels: JSON.parse('@Html.Raw(Json.Encode(Model.Items.Select(x => x.DisplayName).ToList()))'),
                datasets: [{
                    data: JSON.parse('@Html.Raw(Json.Encode(Model.Items.Select(x => x.Count).ToList()))'),
                    backgroundColor: [
                        'rgb(54, 162, 235)', // blue
                        'rgb(255, 99, 132)', // red
                        'rgb(75, 192, 192)' // green
                    ]
                }],
            },
            options: {
                responsive: true
            }
        });
    </script>
}
